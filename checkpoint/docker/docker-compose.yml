services:
  node0:
    build:
      context: ..
      dockerfile: docker/Dockerfile.cpu
    container_name: checkpoint-node0
    hostname: node0
    environment:
      - DISTRIBUTED_MODE=docker
      - WORLD_SIZE=2
      - NODE_RANK=0
      - LOCAL_RANK=0
      - MASTER_ADDR=node0
      - MASTER_PORT=29500
      - BACKEND=gloo
      - SHARED_FS_PATH=/shared/snapshots
      - SHARED_FS_TYPE=local
    volumes:
      - shared_snapshots:/shared/snapshots
      - ..:/app
    networks:
      - checkpoint-net
    command: ["python3", "-c", "import time; time.sleep(3600)"]

  node1:
    build:
      context: ..
      dockerfile: docker/Dockerfile.cpu
    container_name: checkpoint-node1
    hostname: node1
    environment:
      - DISTRIBUTED_MODE=docker
      - WORLD_SIZE=2
      - NODE_RANK=1
      - LOCAL_RANK=0
      - MASTER_ADDR=node0
      - MASTER_PORT=29500
      - BACKEND=gloo
      - SHARED_FS_PATH=/shared/snapshots
      - SHARED_FS_TYPE=local
    volumes:
      - shared_snapshots:/shared/snapshots
      - ..:/app
    networks:
      - checkpoint-net
    depends_on:
      - node0
    command: ["python3", "-c", "import time; time.sleep(3600)"]

volumes:
  shared_snapshots:

networks:
  checkpoint-net:
    driver: bridge
